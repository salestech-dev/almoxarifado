@model List<Almoxarifado.Models.Produtos>

@{
    ViewData["Title"] = "Lista de Produtos";
}

<div class="container mt-4">
    <h1>Lista de Produtos</h1>
    
    <!-- Alertas de mensagens -->
    @if (TempData["Sucesso"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>‚úì Sucesso!</strong> @TempData["Sucesso"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    
    @if (TempData["Erro"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>‚úó Erro!</strong> @TempData["Erro"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    
    @if (TempData["Alerta"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>‚ö† Aten√ß√£o!</strong> @TempData["Alerta"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    
    <!-- Alerta geral de produtos cr√≠ticos -->
    @if (ViewBag.ProdutosCriticos != null && ViewBag.ProdutosCriticos > 0)
    {
        <div class="alert alert-danger">
            <strong>üö® ALERTA GERAL:</strong> Existem <strong>@ViewBag.ProdutosCriticos produto(s)</strong> com estoque cr√≠tico ou esgotado!
            <a href="/Produtos/Criticos" class="alert-link">Ver produtos cr√≠ticos</a>
        </div>
    }
    
    <!-- Campo de Busca -->
    <div class="mb-3">
        <form method="get" action="/Produtos/Index" class="row g-2">
            <div class="col-md-8">
                <input type="text" name="busca" class="form-control" placeholder="Buscar produto por nome ou ID..." value="@ViewBag.BuscaAtual" />
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">üîç Buscar</button>
            </div>
            <div class="col-md-2">
                <a href="/Produtos/Index" class="btn btn-secondary w-100">‚úñ Limpar</a>
            </div>
        </form>
    </div>
    
    <div class="d-flex justify-content-between mb-3">
        <a href="/Produtos/Criar" class="btn btn-primary">‚ûï Adicionar Novo Produto</a>
        <a href="/Produtos/Criticos" class="btn btn-danger">‚ö† Ver Produtos Cr√≠ticos</a>
    </div>
    
    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Quantidade</th>
                        <th>Status</th>
                        <th>Estoque M√≠nimo</th>
                        <th>Data de Entrada</th>
                        <th>Peso</th>
                        <th>Movimenta√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var produto in Model)
                    {
                        <tr class="@(produto.StatusEstoque == "Critico" || produto.StatusEstoque == "Esgotado" ? "table-danger" : 
                                     produto.StatusEstoque == "Atencao" ? "table-warning" : "")">
                            <td>@produto.id</td>
                            <td><strong>@produto.nome</strong></td>
                            <td>
                                <span class="badge bg-@produto.CorAlerta" style="font-size: 1em;">
                                    @produto.quantidade un
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-@produto.CorAlerta">
                                    @produto.StatusEstoque
                                </span>
                            </td>
                            <td>@produto.estoqueMinimo un</td>
                            <td>@produto.dataEntrada.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@produto.peso</td>
                            <td>
                                <!-- Bot√£o Entrada -->
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#modalEntrada@(produto.id)">
                                    ‚¨Ü Entrada
                                </button>
                                
                                <!-- Bot√£o Sa√≠da -->
                                <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#modalSaida@(produto.id)"
                                        @(produto.quantidade == 0 ? "disabled" : "")>
                                    ‚¨á Sa√≠da
                                </button>
                                
                                <!-- Modal Entrada -->
                                <div class="modal fade" id="modalEntrada@(produto.id)" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header bg-success text-white">
                                                <h5 class="modal-title">Entrada de Estoque - @produto.nome</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <form method="post" action="/Produtos/Entrada/@produto.id">
                                                <div class="modal-body">
                                                    <p>Estoque atual: <strong>@produto.quantidade unidades</strong></p>
                                                    <div class="mb-3">
                                                        <label class="form-label">Quantidade a adicionar:</label>
                                                        <input type="number" name="quantidade" class="form-control" min="1" required />
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                    <button type="submit" class="btn btn-success">Confirmar Entrada</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Modal Sa√≠da -->
                                <div class="modal fade" id="modalSaida@(produto.id)" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header bg-info text-white">
                                                <h5 class="modal-title">Sa√≠da de Estoque - @produto.nome</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <form method="post" action="/Produtos/Saida/@produto.id">
                                                <div class="modal-body">
                                                    <p>Estoque atual: <strong>@produto.quantidade unidades</strong></p>
                                                    <div class="mb-3">
                                                        <label class="form-label">Quantidade a retirar:</label>
                                                        <input type="number" name="quantidade" class="form-control" min="1" max="@produto.quantidade" required />
                                                    </div>
                                                    @if (produto.quantidade <= produto.estoqueMinimo)
                                                    {
                                                        <div class="alert alert-warning">
                                                            ‚ö† Aten√ß√£o: Este produto j√° est√° com estoque baixo!
                                                        </div>
                                                    }
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                    <button type="submit" class="btn btn-info">Confirmar Sa√≠da</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td style="white-space: nowrap;">
                                <a href="/Produtos/Edit/@produto.id" class="btn btn-sm btn-warning">‚úè Editar</a>
                                <form method="post" action="/Produtos/Delete/@produto.id" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Tem certeza que deseja deletar este produto?')">üóë Deletar</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="alert alert-info">Nenhum produto cadastrado ainda.</p>
    }
</div>
